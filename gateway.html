<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Things Network Dunedin</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

	<!-- Custom CSS -->
    <link href="css/TNWD-Style.css" rel="stylesheet">
	<!-- Include Footer Style Css -->
	<link rel="stylesheet" href="css/footer.css">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="index.html">Things Network Dunedin</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <!-- <li>
                        <a href="blogmain.html">Blog</a>
                    </li> -->
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutorials<b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li>
                                <a href="gateway.html">Gateway</a>
                            </li>
                            <li>
                                <a href="raspberryPi.html">Setting up Raspberry Pi</a>
                            </li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Other<b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li>
                                <a href="faq.html">FAQ</a>
                            </li>
                        </ul>
                    </li>
                    <!-- <li>
                        <a href="contact.html">Contact</a>
                    </li> -->
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

	<!-- Page Content -->
    <div class="container">
		<div class="bottom-padding">
			<!-- Page Heading/Breadcrumbs -->
			<div class="row">
				<div class="col-lg-12">
					<h1 class="page-header">LoRaWan Gateway
						<small>by <a href="#">Andrew Fletcher</a>
						</small>
					</h1>
					<ol class="breadcrumb">
						<li class="active"></li>
					</ol>
				</div>
			</div>
			<!-- /.row -->
			<!-- Content Row -->
			<div class="row">
				<!-- Tutorial Content Column -->
				<div class="col-lg-12">
					<!-- Preview Image -->
					<img class="img-responsive" src="images/gateway_hardware.jpg" alt="">
					<hr>
					<!-- Post Content -->
					<p class="lead">Creating a LoRaWAN Gateway</p>
					<p>There are many options you can pursue when choosing the hardware to use for LoRaWAN applications. You can choose to simply buy the pre-made TTN Gateway directly from TTN themselves, or you can choose a cheaper, more DIY route.</p>
					<p>For our LoRaWAN Gateway we chose to build and configure our own. This quick how-to describes how our gateway was created, from choosing the correct parts to installing software.</p>
					<h4>Choosing the Correct Hardware </h4>
					<p>When building the gateway for yourself you need to make sure the hardware you choose is compatible. There are multiple options, but we will only focus on the option that we pursued.</p>
					<hr>
					<div class="col-lg-4">
						<img class="img-responsive" src="images/raspberryPi.jpg" alt="">
					</div>
					<div class="col-lg-8 bottom-padding">
						<p class="lead">RaspberryPi</p>
						<p>A Raspberry Pi is used as the main controller for the gateway. It will hold and run our software, and will be connected to the rest of our devices. Any Raspberry Pi model will do, but faster is generally better. We used a Raspberry Pi 1, Model B. This is one of the earlier models, but had enough speed to be able to keep up. We would recommend either a Raspberry Pi 2 or Raspberry Pi 3.</p>
						<p class="bottom-padding-small">Differences between the models can be found <a href="https://https://en.wikipedia.org/wiki/Raspberry_Pi#Specifications" target="_blank">HERE</a></p>
						<p>You can buy these boards from a variety of places around New Zealand, or you can import from overseas. I highly recommend <a href="http://nz.element14.com/raspberrypi-boards" target="_blank">element14</a>, As they are cheap and offer free delivery if your order is over $45.</p>
					</div>
					<div class="col-lg-12">
						<div class="col-lg-8">
							<p class="lead">Multitech mCard-LoRa</p>
							<p>This is the sender and receiver of LoRaWAN packets, without this hardware the gateway will not be able to talk to our nodes. This device comes with an antenna, and is PCIe compatible.</p>
						</div>
						<div class="col-lg-4">
							<img class="img-responsive img-small" src="images/mCard.jpg" alt="">
						</div>

						<div class="col-lg-8">
							<p class="lead">USB to Mini-PCIe Convertor</p>
							<p>This adaptor is necessary to connect the mCard to the Raspberry Pi, as the Pi does not have a Mini-PCIe slot itself.</p>
						</div>
						<div class="col-lg-4">
							<img class="img-responsive img-small" src="images/mini-pcie.jpg" alt="">
						</div>
					</div>

					<div class="col-lg-8">
						<p class="lead">Installing and Running Software</p>
					</div>
					<div class="col-lg-12">
						<p>To be able to install the gateway software on the Raspberry Pi, the Pi itself needs to be set up. We used <a href="https://www.raspberrypi.org/downloads/raspbian/" target="_blank">Raspbian</a>, a version of Debian designed to run on a Raspberry Pi’s architecture. We won’t cover <a href="https://www.raspberrypi.org/documentation/installation/installing-images/README.md" target="_blank">how to install Raspbian</a>, as there is already a lot of documentation out there for it and it can be installed incredibly quickly and easily through NOOBS for Raspberry Pi.</p>
					</div>
<figure class="highlight">
<pre><code>sudo apt-get update
sudo apt-get install git --assume-yes
sudo apt-get install libftdi-dev --assume-yes
cd ~
wget http://libmpsse.googlecode.com/files/libmpsse-1.3.tar.gz
tar zxvf libmpsse-1.3.tar.gz
cd libmpsse-1.3/src
./configure --prefix=/usr --disable-python
make
sudo make install
cd /etc/udev/rules.d
sudo wget https://raw.githubusercontent.com/mirakonta/lora_gateway/master/libloragw/99-libftdi.rules
sudo udevadm control --reload-rules
sudo udevadm trigger
sudo adduser pi plugdev
cd ~</code></pre>
</figure>
      <p class="lead">Now we have our dependencies we can download and compile the LoRaWAN Gateway Software:</p>
<figure class="highlight">
<pre><code>mkdir ~/lora
cd ~/lora
mkdir exec
git clone https://github.com/mirakonta/lora_gateway.git
git clone https://github.com/mirakonta/packet_forwarder.git
cd ~/lora/lora_gateway
make clean all
cd ~/lora/packet_forwarder
make clean all
cp ~/lora/packet_forwarder/basic_pkt_fwd/basic_pkt_fwd ~/lora/exec/
cp ~/lora/packet_forwarder/basic_pkt_fwd/*.json ~/lora/exec/
cd ~/lora/exec</code></pre>
</figure>
    <p class="lead">The gateway code is now compiled and ready to go. To run the gateway, simply run the command:</p>
<figure class="highlight">
<pre><code>sudo ./basic_pkt_fwd</code></pre>
</figure>

<div class="col-lg-8">
						<p class="lead">Running the Gateway Automatically (Headless)</p>
					</div>
					<div class="col-lg-12">
						<p>After installing and configuring the gateway using the above steps, you may find it desirable to have the gateway software run automatically, rather than logging in to the Pi and starting it manually.</p>
						<p>To do this, we would use <a href="https://en.wikipedia.org/wiki/Cron" target="_blank">Cron</a>. Cron is a job scheduler which is built-in to many versions of Linux. Do the following to start the LoRa gateway software at boot:</p>
						&nbsp
						<p>After logging in to the Pi, type: </p>
<figure class="highlight">
<pre><code>sudo crontab -e
</code></pre>
</figure>
						<p>Use the down arrow to move to the end of the file and type: </p>
<figure class="highlight">
<pre><code>“@reboot ./[location of basic_pkt_fwd]
</code></pre>
</figure>
						<p>This tells Cron to run the job at boot.</p>
						<p class="bottom-padding">Now save the file and restart the gateway. If the software runs at startup, you have successfully set everything up. If not, you may need to check the crontab file or recheck the directory the file is in for any mistakes.</p>

					</div>
					<div class="col-lg-4">
						<img class="img-responsive" src="images/gateway.jpg" alt="">
					</div>
					<div class="col-lg-8 bottom-padding">
						<p class="lead">Troubleshooting Hardware (optional)</p>
						<p>Something you may need to do is a small hardware modification on the Mini-PCIe adaptor to provide more power to the antennae. We didn’t end up having to do it, as our board worked anyway. However, if you have completely set up the gateway and it still doesn’t seem to be working, you can try this optional step.</p>
						<p>Sometimes it may be necessary to provide extra power to a couple of the pins on the adaptor. To do this we need to solder a wire from the 5V pin on the USB connector to pins 23 and 25 of the PCIe connector. Below is a picture of the completed modification:</p>
					</div>


      </div>
				</div>


			</div>
			<!-- /.row -->
        </div>

	</div>
    <!-- /.container -->

	<!-- Footer Section -->
	<footer class="footer-distributed">
	  <div class="footer-left">
		<a class="smlImgWidth" ><img src="images/ttn.jpg" alt="Site Logo"></a>
		<a class="smlImgWidth" ><img src="images/lora.jpg" alt="Site Logo"></a>
	  </div>
	  <div class="footer-center">
		

		<!--
		<div>
		  <i class="fa fa-envelope"></i>
		  <p><a href="mailto:support@company.com">support@company.com</a></p>
		</div>
		-->
	  </div>
	  <div class="footer-right">
		<div>
		  <div>

		  <p><span>D Block Harbour Terrace</span> Dunedin, New Zealand</p>
		</div>
		  <p><span>New Zealand 0800 762 786</span></p>
		  <p><span>International +64 3 477 3014</span></P>
		</div>
	  </div>

	</footer>
	<!-- /.Footer Section -->

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
  </body>
</html>
